<div
  *ngIf="selections.datasets.length > 0; then datasetsavailable; else dialog"
></div>

<ng-template #datasetsavailable>
  <div
    *ngIf="validDatasets > 1; then vectorautoregression; else inValidSelections"
  ></div>
</ng-template>
<ng-template #vectorautoregression>
  <div class="var-wrapper">
    <mat-card>
      <div *ngIf="countries.length > 0">
        <div class="toggle-container">
          <div class="model-selector">
            <p
              style="font-size: 18px; font-weight: lighter; margin-bottom: 10px"
            >
              Model
            </p>
            <mat-radio-group
              aria-label="Select a model"
              [(ngModel)]="selectedModel"
              (change)="
                updateParameterSlider($event.value); updateVarForecast()
              "
            >
              <mat-radio-button value="var"
                >Vector Auto Regression</mat-radio-button
              >
              <mat-radio-button value="hwes">HW Smoothing</mat-radio-button>
            </mat-radio-group>
          </div>
          <div class="data-selector">
            <div>
              <p class="section-label">Forecasted data</p>
              <ng-container *ngFor="let dataset of selections.datasets">
                <mat-checkbox
                  *ngIf="
                    dataset.id !== undefined &&
                    dataset.featureSelected !== undefined
                  "
                  [(ngModel)]="activeDatasets[dataset.id]"
                  [disabled]="selectableDatasets[dataset.id] === false"
                  (change)="updateVarForecast()"
                >
                  {{ dataset.name }}
                </mat-checkbox>
              </ng-container>
            </div>
          </div>
        </div>

        <div class="toggle-container">
          <section class="slider-section">
            <p
              style="font-size: 18px; font-weight: lighter; margin-bottom: 10px"
            >
              Number of forecasts
            </p>
            <mat-slider
              thumbLabel
              [(ngModel)]="predictionPeriods"
              (change)="updateVarForecast()"
              aria-label="unit(s)"
              [min]="0"
              [max]="40"
            ></mat-slider>
          </section>
          <section *ngIf="selectedModel == 'var'; else elseBlock">
            <p
              style="font-size: 18px; font-weight: lighter; margin-bottom: 10px"
            >
              Max Lags
            </p>
            <mat-slider
              class="lags-slider"
              thumbLabel
              [(ngModel)]="maxLags"
              (change)="updateVarForecast()"
              aria-label="unit(s)"
              [min]="1"
              [max]="8"
            ></mat-slider>
          </section>
          <ng-template #elseBlock>
            <section>
              <p
                style="
                  font-size: 18px;
                  font-weight: lighter;
                  margin-bottom: 10px;
                "
              >
                &#945;-Parameter
              </p>
              <mat-slider
                class="lags-slider"
                thumbLabel
                [(ngModel)]="maxLags"
                (change)="updateVarForecast()"
                aria-label="unit(s)"
                [step]="0.01"
                [min]="0.01"
                [max]="0.99"
              ></mat-slider>
            </section>
          </ng-template>
        </div>
        <plotly-plot
          *ngIf="
            data.data.length > 0 && showSpinner === false;
            else LoadingSpinner
          "
          [data]="data.data"
          [layout]="data.layout"
          [config]="data.config"
        >
        </plotly-plot>
        <ng-template #LoadingSpinner>
          <div class="loading-spinner">
            <mat-spinner *ngIf="showSpinner === true"></mat-spinner>
          </div>
        </ng-template>
      </div>
    </mat-card>
  </div>
</ng-template>

<ng-template #inValidSelections>
  <div class="dialog-wrapper">
    <mat-card class="dialog">
      <mat-card-title>
        <mat-icon style="font-size: xx-large; padding: 7px"
          >info_outline</mat-icon
        >
        <div>
          The forecast cannot be computed for the selected country
        </div></mat-card-title
      >
      <br />
      <mat-card-content>
        <p>
          Please select a country which is available in at least two of the data
          sets.
        </p>
        <p>The data sets can be managed through the sidebar.</p>
      </mat-card-content>
    </mat-card>
  </div>
</ng-template>

<ng-template #dialog>
  <app-fileupload></app-fileupload>
</ng-template>
